/*! jQuery jSlabify plugin v2.6 MIT/GPL2 @gschoppe */
!function(e){e.fn.jSlabify=function(t){var i={targetFont:!1,fontZoom:1,constrainHeight:!1,slabRatio:1,fixedHeight:!1,hCenter:!1,vCenter:!1,forceNewCharCount:!0,wrapAmpersand:!0,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:!1,resizeThrottleTime:300,maxFontSize:999,postTweak:!0,minWordSpace:.4,maxWordSpace:3,maxLetterSpace:1.5,precision:3,minCharsPerLine:2};return e("body").addClass("slabified"),this.each(function(){t&&e.extend(i,t);var n=e(this),a=e("span.slabbedtext",n).length,r=null,s=null,o=String(e.trim(n.text())).replace(/\s{2,}/g," ").split(" "),l=[],h=[],d=i.targetFont,p=i.fontZoom,m=i.constrainHeight,c=i.slabRatio,g=i.fixedHeight,f=i.hCenter,u=i.vCenter,v=i.forceNewCharCount,x=i.headerBreakpoint,w=i.viewportBreakpoint,b=i.postTweak,y=i.minWordSpace,M=i.maxWordSpace,T=i.maxLetterSpace,z=i.precision,C=i.resizeThrottleTime,S=i.minCharsPerLine,F=null,L=e(window).width(),H=n.find("a:first").attr("href")||n.attr("href"),W=H?n.find("a:first").attr("title"):"";if(!(!a&&S&&o.join(" ").length<S)){if(a){var j=document.createElement("div");e(j).html(n.html());for(var D,k;D=j.querySelectorAll("span.slabbedtext")[0];){var R=e(D).text();i.wrapAmpersand&&(R=R.replace(/&/g,'<span class="amp">&amp;</span>'));var A=e(D)[0].previousSibling;A=A&&A.nodeValue?A.nodeValue.replace(/\s{2,}/g," ").trim():"",k=e(D)[0].nextSibling,k=k&&k.nodeValue?k.nodeValue.replace(/\s{2,}/g," ").trim():"",""!=A&&(l.push({type:0,value:A}),h.push(A)),l.push({type:1,value:R,raw:D.outerHTML}),e(D).prevAll().remove(),e(D).remove()}""!=k&&(l.push({type:0,value:k}),h.push(k)),h=h.join(" "),e(j).remove()}var B=function(){var t=o.join(" "),i=(t.length,t.length>0?t:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-'\".,?!&");return divDef='<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:'+n.css("line-height")+';border:0;white-space:nowrap;word-spacing:0;letter-spacing:0;">',dummy=e(divDef+i+"</div>").appendTo(n),emW=dummy.width(),emH=dummy.height(),ratio=0==emH?1:emW/emH,charRatio=ratio/i.length,dummy2=e(divDef+"&nbsp;</div>").appendTo(n),s=dummy2.width()/parseFloat(dummy2.css("font-size"),10),dummy.remove(),dummy2.remove(),[emW,emH,ratio,i.length,charRatio,s]},P=function(){function t(t,n){for(var a,r,s=0,o=[],l="",h="",d="",p=t;s<n.length;){for(h="";h.length<=p&&(l=h,h+=n[s]+" ",!(++s>=n.length)););l=e.trim(l),h=e.trim(h),a=p-l.length,r=h.length-p,r>a&&l.length>=Math.max(S||2)?(d=l,s--):d=h,remainingText=n.slice(s).join(" "),remainingText.length>0&&remainingText.length<p&&(newLineDiff=Math.max((p-remainingText.length,Math.abs(d.length-p))),oneLineDiff=Math.abs(d.length+remainingText.length+1-p),(oneLineDiff<newLineDiff||remainingText.length<Math.max(S,3))&&(d+=" "+remainingText,s=n.length)),d=e("<div/>").text(d).html(),i.wrapAmpersand&&(d=d.replace(/&amp;/g,'<span class="amp">&amp;</span>')),d=e.trim(d),o.push('<span class="slabbedtext">'+d+"</span>")}return o}var C,F,j=n.width(),D=g?n.height():j/c;if(u?n.height(D):g||n.css("height","auto"),n.removeClass("slabbedtextdone slabbedtextinactive"),w&&w>L||x&&x>j)return void n.addClass("slabbedtextinactive");if(C=B(),v||F!=r){if(r=C[1],s=C[5],d){var k=C[4],R=Math.min(60,Math.floor(j/(r*k*p)));E=Math.round(C[3]/R)}else var A=C[3],P=C[2],V=j/D,E=Math.round(Math.sqrt(P/V)),R=Math.min(60,Math.max(Math.round(A/E),1));if(a){E=Math.max(E,l.length);for(var q=E-a,I=[],N=0;N<l.length;N++)if(l[N].type)I.push(l[N].raw);else{var Z=String(e.trim(l[N].value));charPerLine=Z.length/Math.max(Math.round(q*Z.length/h.length),1),sectionWords=Z.replace(/\s{2,}/g," ").split(" "),I=I.concat(t(charPerLine,sectionWords))}n.html(I.join(""))}else n.html(t(R,o).join(""));H&&n.wrapInner('<a href="'+H+'" '+(W?'title="'+W+'" ':"")+"/>")}else r=C[1];n.has("div.innerslabwrap").length>0||n.wrapInner('<div class="innerslabwrap" />');var Q=n.children("div.innerslabwrap");Q.css("font-size","1em"),e("span.slabbedtext",n).each(function(){var t,n,a=e(this),o=a.text(),l=o.split(" ").length>1,h=parseFloat(a.css("font-size"),10);if(b)if(l){a.css({"word-spacing":""+h*s*y-s*h+"px","letter-spacing":0});var d=o.split(" ").length-1;0>d&&(d=0)}else a.css("letter-spacing",0);a.css("font-size","1em"),t=a.width()>0?j/a.width():1,n=(Math.min(r*t,i.maxFontSize)/r).toFixed(z),a.css("font-size",n+"em")});var G=1;if(m&&Q.height()>D&&(G=(D/Q.height()).toFixed(z),Q.css("font-size",G+"em")),b&&e("span.slabbedtext",n).each(function(){var t=e(this),i=t.text(),n=i.split(" ").length,a=j-t.width(),r=parseFloat(t.css("font-size"),10);if(n>1){var o=a/(n-1);r*s*y>o?o=r*s*y:o>r*s*M&&(o=r*s*M),o-=r*s,t.css("word-spacing",o.toFixed(z)+"px"),a=j-t.width()}var o=a/i.length;0>o?o=0:o>r*s*T&&(o=r*s*T),t.css("letter-spacing",o.toFixed(z)+"px"),(j-t.width())/j>.1&&(t.css("letter-spacing",0),t.css("word-spacing",0))}),n.addClass("slabbedtextdone"),f&&Q.css("text-align","center"),m&&u){var J=((D-Q.height())/2).toFixed(z);Q.css("position","relative").css("top",J+"px")}};P(),i.noResizeEvent||e(window).resize(function(){e(window).width()!=L&&(L=e(window).width(),clearTimeout(F),F=setTimeout(P,C))})}})}}(jQuery);
